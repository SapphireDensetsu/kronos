.TAIL 1 ''
.TAIL 0 ''
.HEAD 1 ''
.HEAD 0 ''



                - Сибирское отделение  АН СССР -




                    - Институт информатики -













:::::      ::::
:::::      ::::
 :::      :::
 :::     ::
 :::    ::
 ::: : :        ::::::       :::    :::   :::    :::       :::
 :::    ::      ::    ::   ::: :::  :::   :::  ::: :::   ::: :::
 :::     :::    ::     :: ::     ::  ::   ::  ::     :: ::
 :::      :::   ::     :: ::     ::  :::::::  ::     :: ::
:::::      :::: :::  :::   ::: :::  :::   :::  ::: :::   ::: :::
:::::      :::: ::::::       :::    :::   :::    :::       :::
                ::
                ::
                ::  КРОНОС ДЛЯ АДМИНИСТРАТОРА











                         Новосибирск - 90
.PAGE
.TAIL 1 '@A%62d@a'
.TAIL 0 '@A%62d@a'


                          СОДЕРЖАНИЕ

1. Перенос ОС Excelsior . . . . . . . . . . . . . . . . . . .4
2. Работа с дисками . . . . . . . . . . . . . . . . . . . . .8
   2.1. Физическая структура диска . . . . . . . . . . . . . 8
   2.2. Логическая структура носителя . . . . . . . . . . . .8
   2.3. Проверка и исправление носителя . . . . . . . . . . .8
3. Подключение внешних устройств . . . . . . . . . . . . . . 9
.PAGE
.HEAD 1 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА                             ВВЕДЕНИЕ@u'
.HEAD 0 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА                             ВВЕДЕНИЕ@u'








     Своевременное    копирование    текстов,   восстановление
поврежденных   кодов   и  магнитных  носителей,  распределение
ресурсов    и    разрешение    конфликтных    ситуаций   между
пользователями,  реконфигурация системы, программная настройка
новых  устройств  -  вот  далеко  не  полный перечень функций,
которые понимаются под словами "сопровождение системы". Обычно
все эти функции возлагаются на администратора системы.
     Опыт   эксплуатации   Кроноса   в  различных  коллективах
показал,   что  функции  администратора  берет  на  себя,  как
правило, самый компетентный и аккуратный человек.
     Эта  книга  целиком  посвящается  тому,  что  относится к
администраторской деятельности.
.PAGE
.HEAD 1 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА                      ПЕРЕНОС СИСТЕМЫ@u'
.HEAD 0 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА       ПОДГОТОВКА СИСТЕМНОГО НОСИТЕЛЯ@u'


                1. ПОДГОТОВКА СИСТЕМНОГО НОСИТЕЛЯ


     Приведем  полный  перечень  действий  для  получения рабочей
версии системы на носителе.

     1.1. Отформатировать диск, если он не сформатирован:

dsu fd0 -f

     1.2. Разметить диск (создать файловую систему):

mkfs /dev/fd0 sys

     1.3. Смонтировать диск:

mou /mnt /dev/fd0

     1.4.  Создать  необходимый  набор  директорий  на корневой
директории носителя:

cd /mnt
mkdir bin ipr sym ref etc usr sys dev mnt

     Здесь
     bin - коды утилит и библиотек;
     sym - симфайлы библиотек;
     ref - реффайлы библиотек;
     ipr - коды драйверов;
     etc - служебные файлы системы;
     dev - специальные файлы;
     sys - рабочая директория администратора;
     usr - рабочая директория для пользователей;

На директории usr:

cd usr
mkdir bin sym ref etc

     bin,sym,ref,etc  - кодофайлы, симфайлы, реффайлы и служебные
файлы специфичные для данной конфигурации.

     1.5.  Создать  необходимый  набор  специальных  файлов  на
директории   dev.  Файлы  для  дисков,  терминалов,  клавиатур  и
драйвера сообщений.

cd /mnt/dev
mknode ENGLISH  err0  o+rw o-x g+rw g-x a+rw a-x
mknode RUSSIAN  err1  o+rw o-x g+rw g-x a+rw a-x
mknode fd0      fd0   o+rw o-x g+rw g-x a+rw a-x
mknode fd1      fd1   o+rw o-x g+rw g-x a+rw a-x
mknode wd0      wd0   o+rw o-x g+rw g-x a+r  a-xw
mknode wd1      wd1   o+rw o-x g+rw g-x a+r  a-xw
mknode tty0     tty0  o+w o-rx g+w g-rx a+w  a-rx
mknode key0     key0  o+r o-wx g+r g-wx a+r  a-wx

     1.6.   Скопировать  на  носитель  файлы,  необходимые  для
реконфигурации системы на диске:

cp /profile.@                          /mnt/      -q
cp /sys/system.cnf|all.@|booter.boot   /mnt/sys/  -q

     /profile.@ - стартовый командный файл формирования окружения;
     /sys/system.cnf - файл конфигурации системы;
     /sys/all.@ - командный файл сборки системы;
     /sys/booter.boot - начальный загрузчик.


     1.7. Откорректировать эти файлы:

ex /profile.@
ex /sys/system.cnf
ex /sys/all.@
ex /sys/booter.boot


     В  файле  system.cnf  необходимо исправить набор драйверов и
набор  строк  конфигурации, а также имя диска, содержащего корень
файлового  дерева при запуске утилиты shell (см. config). Вот как
приблизительно выглядит файл system.cnf:

[1] DKwsWD&
[1] DKwsFD&
[1] TTwsBM&
[5] shell $home -root :wd0&
$   CASH  MEM     128K


     Исправить   файл   profile.@,   если  необходимо  -  создать
отличающееся окружение. Приблизительный вид файла profile.@:

 $echo  off
 $stk   1
 $delay 1
 cd     /bin
 BIN=. /bin /usr/bin
 ETC=. /etc /usr/etc
 { $^ } & /ipr/LEXICON err  /etc/SYSERR.ENG   /etc/SYSERR.RUS
 TTY=/dev/tty0
 KEY=/dev/key0
 MSG=/dev/ENGLISH
 CMASK=--++++-+---
 human -i
 { $^ } & login
 bye

     Исправить  файл  all.@,  если  необходимо,  изменить  состав
подгружаемых к системе утилит. Приблизительный вид файла all.@:

BIN=. /ipr /bin /usr/bin
/bin/config system -mc ex turbo2x mx login $1 $2 $3 $4 $5 $6 $7 $8 $9
BIN=. /bin /usr/bin

     1.8. Собрать систему:

all

     1.9. Записать холодный загрузчик:

config -B /dev/fd0 booter

     1.10. Скопировать систему в файл /mnt/SYSTEM.BOOT:

config -b /mnt  system

     1.11. После копирования можно удалить файл system.boot:

rm system.boot

     1.12. Скопировать необходимые служебные файлы:

cp /etc/                                     /mnt/etc/      -q
cp /usr/etc/PASS.WD|tty0_up.@|*.fnt|*.SETUP  /mnt/usr/etc/  -q


     1.13. Скопировать коды утилит, библиотек и драйверов:

cp /bin/ /mnt/bin/ -q
cp /usr/bin/ /mnt/usr/bin/ -q
cp /ipr/ /mnt/ipr/ -q

     В  случае  создания  системы  на  маленьких  носителях нужно
копировать  только  необходимые  кодофайлы.  Заметим, что большая
часть библиотек собрана в образе системы и копировать их не надо.
Как правило, при работе администратору необходимы утилиты cp, rm,
ls,  config,  boo,  chmode,  mknode. Аналогично, нужно копировать
кодофайлы только тех драйверов, которых нет в образе системы.

     1.14.  При  подготовке  системы  на  жестком  диске  нужно
скопировать также директории /ref, /sym, /usr/ref, /usr/sym.

     1.15.  Произвести  контрольную загрузку системы с ГМД и
убедиться в ее работоспособности.

]boo /dev/fd0

     1.16. Вся описанная последовательность действий может быть
выполнена с помощью командного файла примерно такого вида:

mkfs /dev/fd0 sys
mou /mnt /dev/fd0
cd /mnt
mkdir bin ipr sym ref etc usr sys dev mnt
cd usr
mkdir bin sym ref etc
cd /mnt/dev
mknode ENGLISH  err0  o+rw o-x g+rw g-x a+rw a-x
mknode RUSSIAN  err1  o+rw o-x g+rw g-x a+rw a-x
mknode fd0      fd0   o+rw o-x g+rw g-x a+rw a-x
mknode fd1      fd1   o+rw o-x g+rw g-x a+rw a-x
mknode wd0      wd0   o+rw o-x g+rw g-x a+r  a-xw
mknode wd1      wd1   o+rw o-x g+rw g-x a+r  a-xw
mknode tty0     tty0  o+w o-rx g+w g-rx a+w  a-rx
mknode key0     key0  o+r o-wx g+r g-wx a+r  a-wx
cd /sys
cp /.profile.@                                /mnt/          -q
cp system.cnf all.@ .profile.@ booter5.boot   /mnt/sys/      -q
cd /mnt/sys
ex /mnt/.profile.@
ex system.cnf
ex all.@
du
all
config -B /dev/fd0 booter5
config -b /mnt     system
rm system.boot
cp /usr/etc/PASS.WD|tty0_up.@|*.fnt|*.SETUP  /mnt/usr/etc/  -q
cp /etc/                                     /mnt/etc/      -q
cp /bin/                                     /mnt/bin/      -q
cp /ipr/                                     /mnt/ipr/      -q
cp /usr/bin/                                 /mnt/usr/bin/  -q
chmode /mnt//* owner=su -Tq
cd  /sys
mou /mnt -r


     1.17.Перечень действий по переносу системы с флоппи-дисков
(устройство /dev/fd0) на винчестерский диск (устройство /dev/wd0)
совпадает с перечнем, описанным в пп. 1.1-1.12 с точностью до
названия устройств.
.PAGE
.HEAD 1 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА                     РАБОТА С ДИСКАМИ@u'
.HEAD 0 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА                     РАБОТА С ДИСКАМИ@u'



                     2. РАБОТА С ДИСКАМИ


     Администратору  системы  часто  приходится  иметь  дело с
магнитными    носителями:   форматировать,   инициализировать,
копировать    и,    что    самое    страшное,    редактировать
низкоуровневыми  средствами  (см.  том "Утилиты ОС Excelsior",
утилиты  работы  с  носителями).  Для  этого  необходимо иметь
представление  об  устройстве носителя в ОС Excelsior.


     2.1. Физическая структура диска

     Чтобы  устройство могло работать с диском, его необходимо
отформатировать.  Контроллер  диска определяет ряд параметров,
которые  могут  варьировать:  число  цилиндров на диске, число
головок,  количество  секторов  на  дорожке,  размер  сектора.
Значения  этих параметров указаны в технической документации к
контроллеру   и   определяют   формат.  Формат  необходим  при
написании драйвера соответствующего устройства.
     Так,  например,  на  РС  "Кронос-2.6WS"  установлен НГМД,
работающий   с  5-дюймовыми  дисками,  на  которых  установлен
следующий формат:
     число цилиндров     -   40;
     число головок       -    2;
     количество секторов -    5;
     размер  сектора     - 1024.

     В  ОС  Excelsior функцию форматирования выполняет утилита
dsu, которая  запускается  в  этом  случае  с  ключом 'f' (см.
"Утилиты ОС Excelsior").


     2.2. Логическая структура носителя

     Логическая структура носителя определена и поддерживается
файловой   подсистемой.   Описание   структуры   приведено   в
Руководстве  по  ОС  Excelsior  в  разделе  "Диск  в  файловой
подсистеме".
     После форматирования носителя прежде, чем на него может быть
записана   какая-либо  информация,  он  должен  быть  размечен  в
соответствии  со  стандартом,  принятым в системе. Разметка диска
производится с помощью утилиты mkfs (см. "Утилиты ОС Excelsior").
После  этого  он  может  быть  смонтирован  в  файловую систему с
помощью утилиты mou.


     2.3. Проверка и исправление носителя

     На    администратора   системы   возлагается   ответственная
обязанность  регулярной  проверки  и  своевременного  исправление
системного  носителя.  Для  этого предназначаются утилиты fschk и
fsdb, описание которых можно найти в справочнике по утилитам.
.PAGE
.HEAD 1 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА                   ВНЕШНИЕ УСТРОЙСТВА@u'
.HEAD 0 '@UКРОНОС ДЛЯ АДМИНИСТРАТОРА                   ВНЕШНИЕ УСТРОЙСТВА@u'


               3. ПОДКЛЮЧЕНИЕ ВНЕШНИХ УСТРОЙСТВ

     ОС Excelsior - развиваемая и легко настраиваемая система.
Универсальность     программного    обеспечения    достигается
независимостью   от   типов   внешних  устройств,  входящих  в
конфигурацию  системы.  Настройка  на  конкретную конфигурацию
производится  с помощью драйверов внешних устройств. Сведения,
необходимые  для  написания драйверов, приведены в Руководстве
по ОС Excelsior в разделе "Драйверы внешних устройств".
