MODULE t; (*  22-Feb-91. (c) KRONOS *)IMPORT  wnd : libWindows;IMPORT  vg  : cdsGrafic;IMPORT  str : Strings;PROCEDURE pcb_number(w: wnd.window; x,y,cx,cy: INTEGER; ch: CHAR;                     VAR num: INTEGER): BOOLEAN;  PROCEDURE print_num(n,x,color: INTEGER);    VAR l: INTEGER; ln: ARRAY [0..79] OF CHAR;  BEGIN    vg.prop_font(w,FALSE); w^.patt:={0..31};    vg.mode(w,vg.bic); vg.color(w,15); vg.box(w,x,y,x+74,y+14);    vg.mode(w,vg.rep); vg.color(w,1); vg.frame(w,x,y,x+74,y+14);    vg.mode(w,vg.xor); vg.color(w,2); vg.box(w,x+1,y,x+74,y+13);    vg.color(w,INTEGER({1}/BITSET(color)));    str.print(ln,'%d.%$2d',n/100,ABS(n REM 100));    l:=vg.string_len(FALSE,ln,0);    IF l>72 THEN vg.write_string(w,x+2,y+1,'*******');    ELSE vg.write_string(w,x+73-l,y+1,ln)    END;  END print_num;  PROCEDURE edit_num(VAR n: INTEGER; x: INTEGER): BOOLEAN;     VAR i,j: INTEGER; ch: CHAR; pnt: BOOLEAN;  BEGIN    pnt:=FALSE; wnd.del_crs;    LOOP      print_num(n,x,8); wnd.ref_box(w,y,15);      REPEAT wnd.wait; wnd.first(i,j,ch); wnd.drop UNTIL ch#0c;      IF (ch=15c) OR (ch=wnd.l_on) THEN RETURN TRUE END;      IF (ch=33c) OR (ch=wnd.r_on) THEN RETURN FALSE END;      IF ch=10c THEN n:=n/10      ELSIF ch='-' THEN IF n#MIN(INTEGER) THEN n:=-n END;      ELSIF ch=' ' THEN n:=0;      ELSIF ch='.' THEN        pnt:=NOT pnt;        IF pnt THEN n:=n/100*100 END;      ELSIF (ch>='0') & (ch<='9') THEN        IF pnt THEN          i:=ABS(n REM 100);          i:=(i*10+ORD(ch)-ORD('0')) REM 100;          IF n<0 THEN n:=n/100*100+i ELSE n:=n/100*100+i END;        ELSIF n>=0 THEN          IF  n<1000000 THEN            n:=n REM 100 + (n/100*10+(ORD(ch)-ORD('0')))*100;          END;        ELSE          IF -n<1000000 THEN            n:=n REM 100 + (n/100*10-(ORD(ch)-ORD('0')))*100;          END;        END;      END;    END;  END edit_num;  VAR n: INTEGER;BEGIN  IF ch=0c THEN RETURN FALSE END;  IF ch=1c THEN    vg.mode(w,vg.bic); vg.color(w,15); vg.box(w,x,y,x+219,y+14);    vg.mode(w,vg.rep); vg.color(w,2); vg.box(w,x,y,x+219,y+14);    vg.mode(w,vg.or); vg.color(w,1); vg.prop_font(w,TRUE);    vg.write_string(w,x+76,y+1,'x1.25');    vg.write_string(w,x+201,y+1,'ออ');    print_num((num*50+12) DIV 24,x,0);    print_num((num*125+24) DIV 48,x+125,0);    RETURN TRUE;  END;  IF (cy<y) OR (cy>=y+15) THEN RETURN FALSE END;  IF (cx>=x) & (cx<x+75) THEN    IF ch=' ' THEN n:=0;    ELSIF ch=wnd.l_on THEN n:=(num*50+12) DIV 24;    ELSE RETURN FALSE;    END;    IF edit_num(n,x) THEN num:=(n*24+25) DIV 50 END;    print_num((num*50+12) DIV 24,x,0);    print_num((num*125+24) DIV 48,x+125,0);    wnd.ref_box(w,y,15); RETURN TRUE;  ELSIF (cx>=x+125) & (cx<x+200) THEN    IF ch=' ' THEN n:=0;    ELSIF ch=wnd.l_on THEN n:=(num*125+24) DIV 48;    ELSE RETURN FALSE;    END;    IF edit_num(n,x+125) THEN num:=(n*48+62) DIV 125 END;    print_num((num*50+12) DIV 24,x,0);    print_num((num*125+24) DIV 48,x+125,0);    wnd.ref_box(w,y,15); RETURN TRUE;  ELSE RETURN FALSE;  END;END pcb_number;VAR w: wnd.window; n,x,y: INTEGER; c: CHAR;BEGIN  n:=960;  w:=wnd.create(300,50);  wnd.open(w);  IF pcb_number(w,0,0,0,0,1c,n) THEN END;  wnd.refresh(w);  LOOP    IF pcb_number(w,0,0,x,y,c,n) THEN END;    wnd.read_point(wnd.rp_free,x,y,x,y,c);  END;END t.